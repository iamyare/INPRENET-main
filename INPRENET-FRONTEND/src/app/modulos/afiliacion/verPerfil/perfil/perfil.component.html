<div class="perfil-container">
  <div class="header-actions">
    <button mat-icon-button (click)="resetBusqueda2()" class="search-again">
      <mat-icon>search</mat-icon>
    </button>
    <span class="search-text">Buscar otro Afiliado</span>
  </div>
  <div class="perfil-header">
    <div class="perfil-foto">
      <img *ngIf="persona.foto_perfil" [src]="getFotoUrl(persona.foto_perfil)" alt="Foto de Perfil">
    </div>
    <div class="perfil-datos">
      <h2>
        {{ persona.primer_nombre }}
        {{ persona.segundo_nombre }}
        {{ persona.tercer_nombre }}
        {{ persona.primer_apellido }}
        {{ persona.segundo_apellido }}
      </h2>

      <p><strong>DNI:</strong> {{ persona.n_identificacion }}</p>
      <p><strong>Teléfono:</strong> {{ persona.telefono_1 }}</p>
      <p><strong>Correo Principal:</strong> {{ persona.correo_1 }}</p>
      <p><strong>Género:</strong> {{ persona.genero }}</p>
      <p><strong>Fecha de Nacimiento:</strong> {{ convertirFecha(persona.fecha_nacimiento, false) }}</p>

      <!-- NUEVOS CAMPOS: -->
      <p>
        <strong>Fecha de Afiliación:</strong>
        <span [ngClass]="{ 'campo-null': !persona.fecha_afiliacion }">
          {{ persona.fecha_afiliacion
             ? convertirFecha(persona.fecha_afiliacion, false)
             : 'No definido' }}
        </span>
      </p>
      <p>
        <strong>Última Fecha de Actualización:</strong>
        <span [ngClass]="{ 'campo-null': !persona.ultima_fecha_actualizacion }">
          {{ persona.ultima_fecha_actualizacion
             ? convertirFecha(persona.ultima_fecha_actualizacion, false)
             : 'No definido' }}
        </span>
      </p>
      
      <p *ngIf="persona.fallecido === 'SI'" class="alerta-fallecido">
        <strong>ESTADO:</strong> FALLECIDO
      </p>

      <!-- MENSAJE si pasó más de 2 años sin actualizar -->
      <p *ngIf="mensajeSinActualizacion" class="alerta-actualizacion">
        {{ mensajeSinActualizacion }}
      </p>      
      <!-- FIN NUEVOS CAMPOS -->

    </div>
  </div>

  <mat-tab-group dynamicHeight>
    <mat-tab label="INFORMACIÓN GENERAL">
      <app-informacion-general [persona]="persona"></app-informacion-general>
    </mat-tab>
    <mat-tab
      *ngFor="let detalle of detallePersonaUnico; trackBy: trackByPerfil"
      [label]="detalle.tipoPersona.tipo_persona"
    >
      <ng-container [ngSwitch]="detalle.tipoPersona.tipo_persona">
        <app-afiliado *ngSwitchCase="'AFILIADO'" [persona]="persona"></app-afiliado>
        <app-beneficiario *ngSwitchCase="'BENEFICIARIO'" [persona]="persona"></app-beneficiario>
        <app-beneficiario
          *ngSwitchCase="'BENEFICIARIO SIN CAUSANTE'"
          [persona]="persona"
        ></app-beneficiario>
        <app-beneficiario
          *ngSwitchCase="'DESIGNADO'"
          [persona]="persona"
        ></app-beneficiario>
        <app-afiliado *ngSwitchCase="'JUBILADO'" [persona]="persona"></app-afiliado>
        <app-afiliado *ngSwitchCase="'PENSIONADO'" [persona]="persona"></app-afiliado>
      </ng-container>
    </mat-tab>
    <mat-tab *ngIf="isVoluntario()" label="VOLUNTARIO">
      <app-afiliado [persona]="persona"></app-afiliado>
    </mat-tab>
  </mat-tab-group>
</div>
