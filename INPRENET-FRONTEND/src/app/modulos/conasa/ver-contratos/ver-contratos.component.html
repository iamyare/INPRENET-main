<div class="basic-container">
  <!-- Header para búsqueda -->
  <app-perfil-header (personaEncontrada)="handlePersonaEncontrada($event)"></app-perfil-header>
  <div *ngIf="contratos.length > 0" class="card">
    <div class="card-header title">
      <h4 class="card-title">Contratos del Titular</h4>
      <p class="card-category">Información detallada de los contratos</p>
    </div>
    <div class="card-body">
      <div *ngFor="let contrato of contratos" class="contract-card" [ngClass]="{'active': contrato.status === 'ACTIVO'}">
        <mat-card>
          <mat-card-header class="contract-header">
            <mat-card-title class="contract-number">Contrato Nº: {{ formatearDato(contrato.numeroProducto) }}</mat-card-title>
            <span class="status-badge" [ngClass]="{
                'status-active': contrato.status === 'ACTIVO',
                'status-inactive': contrato.status !== 'ACTIVO'
              }">
              {{ contrato.status }}
            </span>
            <button *ngIf="contrato.status === 'ACTIVO'" mat-raised-button color="warn" (click)="abrirModalCancelar(contrato)" class="cancel-btn">
              Cancelar Contrato
            </button>
          </mat-card-header>          
          <mat-card-content>
            <p><strong>Lugar de Cobro:</strong> {{ formatearDato(contrato.lugarCobro) }}</p>
            <p><strong>Fecha de Inicio:</strong> {{ formatearDato(contrato.fechaInicioContrato) }}</p>
            <p><strong>Fecha de Cancelación:</strong> {{ formatearDato(contrato.fechaCancelacionContrato) }}</p>
            <p><strong>Plan:</strong> {{ formatearDato(contrato.plan?.nombrePlan) }}</p>
            <p><strong>Monto del Plan:</strong> L. {{ contrato.plan?.precio | number: '1.2-2' }}</p>
          </mat-card-content>
        </mat-card>

        <!-- Beneficiarios -->
        <div class="beneficiaries-section" *ngIf="contrato.beneficiarios.length > 0">
          <h4>Beneficiarios</h4>
          <div *ngFor="let beneficiario of contrato.beneficiarios" class="beneficiary-card">
            <mat-card>
              <mat-card-content>
                <p><strong>Nombre:</strong> {{ formatearDato(beneficiario.nombreCompleto) }}</p>
                <p><strong>Parentesco:</strong> {{ formatearDato(beneficiario.parentesco) }}</p>
                <p><strong>Fecha de Nacimiento:</strong> {{ formatearDato(beneficiario.fechaNacimiento) }}</p>
              </mat-card-content>
            </mat-card>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Cancelación -->
  <div *ngIf="contratoSeleccionado" class="cancel-modal">
    <div class="modal-content">
      <h2>Cancelar Contrato</h2>
      <p>¿Está seguro de cancelar el contrato Nº: {{ formatearDato(contratoSeleccionado.numeroProducto) }}?</p>
      <mat-form-field appearance="outline" class="motivo-field">
        <mat-label>Motivo de Cancelación</mat-label>
        <textarea matInput [(ngModel)]="motivoCancelacion"></textarea>
      </mat-form-field>
      <div class="modal-actions">
        <button mat-raised-button color="warn" (click)="cancelarContrato()">Confirmar</button>
        <button mat-raised-button color="primary" (click)="cerrarModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Mensaje si no hay contratos -->
  <div *ngIf="persona && contratos.length === 0" class="no-contracts">
    <p>Este titular no tiene contratos registrados.</p>
  </div>
</div>
