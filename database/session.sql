-- Crear tabla NET_SESSION
CREATE TABLE NET_SESSION (
    ID_SESSION NUMBER GENERATED BY DEFAULT AS IDENTITY,
    TOKEN VARCHAR2(500) NOT NULL,
    REFRESH_TOKEN VARCHAR2(500),
    ID_USUARIO_EMPRESA NUMBER,
    USER_AGENT VARCHAR2(500),
    IP_ADDRESS VARCHAR2(50),
    FECHA_CREACION TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP NOT NULL,
    FECHA_EXPIRACION TIMESTAMP(6) NOT NULL,
    ULTIMA_ACTIVIDAD TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP,
    ESTADO VARCHAR2(20) DEFAULT 'ACTIVA' NOT NULL,
    CONSTRAINT PK_NET_SESSION PRIMARY KEY (ID_SESSION),
    CONSTRAINT FK_NET_SESSION_USUARIO_EMPRESA FOREIGN KEY (ID_USUARIO_EMPRESA)
        REFERENCES NET_USUARIO_EMPRESA (ID_USUARIO_EMPRESA) ON DELETE CASCADE,
    CONSTRAINT CHECK_NET_SESSION_ESTADO CHECK (ESTADO IN ('ACTIVA', 'EXPIRADA', 'REVOCADA', 'CERRADA'))
);

-- Índices para optimización
CREATE INDEX idx_net_session_token ON NET_SESSION(TOKEN);
CREATE INDEX idx_net_session_usuario ON NET_SESSION(ID_USUARIO_EMPRESA, ESTADO);
CREATE INDEX idx_net_session_refresh ON NET_SESSION(REFRESH_TOKEN);