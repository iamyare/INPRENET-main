<mat-stepper [linear]="isLinear" #stepper>
  <mat-step *ngIf="mostrarPrimerPaso">
    <form [formGroup]="firstFormGroup">
      <ng-template matStepLabel>Seleccione Centro</ng-template>

      <mat-form-field appearance="fill">
        <mat-label>Filtrar</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Escribe para filtrar">
      </mat-form-field>

      <div>
        <table mat-table [dataSource]="dataSourceItems" matSort >
          <!-- ID Centro de Trabajo Column -->
          <ng-container matColumnDef="id_centro_trabajo">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
            <td mat-cell *matCellDef="let item">{{ item.id_centro_trabajo }}</td>
          </ng-container>

          <!-- Nombre Centro de Trabajo Column -->
          <ng-container matColumnDef="nombre_centro_trabajo">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
            <td mat-cell *matCellDef="let item">{{ item.nombre_centro_trabajo }}</td>
          </ng-container>

          <!-- Header and Row Declarations -->
          <tr mat-header-row *matHeaderRowDef="['id_centro_trabajo', 'nombre_centro_trabajo']"></tr>
          <tr mat-row *matRowDef="let item; columns: ['id_centro_trabajo', 'nombre_centro_trabajo'];" [class.selected]="item === selectedItem" (click)="selectRow(item)"></tr>
        </table>
        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
      </div>

      <p>Ítem seleccionado: {{selectedItem?.nombre_centro_trabajo}}</p>
      <div>
        <button mat-button matStepperNext [disabled]="!selectedItem">Siguiente</button>
      </div>
    </form>
  </mat-step>
  <mat-step *ngIf="mostrarSegundoPaso" [stepControl]="firstFormGroup">
    <form [formGroup]="firstFormGroup">
      <ng-template matStepLabel>Período de planilla</ng-template>
      <mat-selection-list #shoes color="primary" [multiple]="false" formControlName="selectedTipoPlanilla">
        <mat-list-option *ngFor="let tipoPlanilla of tiposPlanillaPrivadas" [value]="tipoPlanilla">
          {{ tipoPlanilla.NOMBRE_PLANILLA }}
        </mat-list-option>
      </mat-selection-list>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext [disabled]="!firstFormGroup.valid" (click)="datosPlanilla()">
          Siguiente
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step label="Datos De Planilla" *ngIf="mostrarTercerPaso">
    <div class="botones-container">
      <button
        mat-raised-button
        class="boton-estetico"
        (click)="agregarDocente()"
      >
        Agregar Docente
      </button>
      <button
        mat-raised-button
        class="boton-estetico"
        (click)="exportarExcelPdf()"
      >
        Exportar a Excel y PDF
      </button>
      <button
        mat-raised-button
        class="boton-estetico"
        (click)="generarActualizarPlanilla()"
      >
        Generar / Actualizar Planilla
      </button>
    </div>
    <div class="datos-container">
      <h2>
        Datos de Planilla {{ dataSource.data[0]?.periodoInicio }} al
        {{ dataSource.data[0]?.periodoFinalizacion }}
      </h2>
      <table mat-table [dataSource]="[{}]">
        <!-- Número de colegio Column -->
        <ng-container matColumnDef="numeroColegio">
          <th mat-header-cell *matHeaderCellDef>Número de colegio</th>
          <td mat-cell *matCellDef>{{ numeroColegio }}</td>
        </ng-container>

        <!-- Nombre del colegio Column -->
        <ng-container matColumnDef="nombreColegio">
          <th mat-header-cell *matHeaderCellDef>Nombre del colegio</th>
          <td mat-cell *matCellDef>{{ nombreColegio }}</td>
        </ng-container>

        <!-- Total Sueldo Column -->
        <ng-container matColumnDef="totalSueldo">
          <th mat-header-cell *matHeaderCellDef>Total Sueldo</th>
          <td mat-cell *matCellDef style="text-align: right">
            {{ totalSueldo | currency : "L" }}
          </td>
        </ng-container>

        <!-- Total Préstamo Column -->
        <ng-container matColumnDef="totalPrestamo">
          <th mat-header-cell *matHeaderCellDef>Total Préstamo</th>
          <td mat-cell *matCellDef style="text-align: right">
            {{ totalPrestamo | currency : "L" }}
          </td>
        </ng-container>

        <!-- Total Aportaciones Column -->
        <ng-container matColumnDef="totalAportaciones">
          <th mat-header-cell *matHeaderCellDef>Total Aportaciones</th>
          <td mat-cell *matCellDef style="text-align: right">
            {{ totalAportaciones | currency : "L" }}
          </td>
        </ng-container>

        <!-- Total Pagar Column -->
        <ng-container matColumnDef="totalPagar">
          <th mat-header-cell *matHeaderCellDef>Total Pagar</th>
          <td mat-cell *matCellDef style="text-align: right">
            {{ totalPagar | currency : "L" }}
          </td>
        </ng-container>

        <!-- Total Cotizaciones Column -->
        <ng-container matColumnDef="totalCotizaciones">
          <th mat-header-cell *matHeaderCellDef>Total Cotizaciones</th>
          <td mat-cell *matCellDef style="text-align: right">
            {{ totalCotizaciones | currency : "L" }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <div class="linea-separadora"></div>

    <button
      mat-raised-button
      (click)="seleccionarBoton('EMPLEADOS'); showTable = true"
      [ngClass]="{ 'boton-seleccionado': botonSeleccionado === 'EMPLEADOS' }"
    >
      EMPLEADOS
    </button>
    <button
      mat-raised-button
      (click)="seleccionarBoton('CALCULO DE RECARGO'); showTable = false"
      [ngClass]="{
        'boton-seleccionado': botonSeleccionado === 'CALCULO DE RECARGO'
      }"
    >
      CALCULO DE RECARGO
    </button>

    <div *ngIf="showTable">
      <mat-form-field>
        <mat-label>Filtro</mat-label>
        <input matInput (keyup)="applyFilter($event)" #input />
      </mat-form-field>

      <div>
        <table mat-table [dataSource]="dataSource" matSort>
          <!-- Identidad Column -->
          <ng-container matColumnDef="identidad">
            <th mat-header-cell *matHeaderCellDef>Identidad</th>
            <td mat-cell *matCellDef="let row">{{ row.identidad }}</td>
          </ng-container>

          <!-- Nombre Docente Column -->
          <ng-container matColumnDef="nombreDocente">
            <th mat-header-cell *matHeaderCellDef>Nombre Docente</th>
            <td mat-cell *matCellDef="let row">{{ row.nombreDocente }}</td>
          </ng-container>

          <!-- Sueldo Column -->
          <ng-container matColumnDef="sueldo">
            <th mat-header-cell *matHeaderCellDef>Sueldo</th>
            <td mat-cell *matCellDef="let row" style="text-align: right">
              {{ row.sueldo | currency : "L" }}
            </td>
          </ng-container>

          <!-- Aportaciones Column -->
          <ng-container matColumnDef="aportaciones">
            <th mat-header-cell *matHeaderCellDef>Aportaciones</th>
            <td mat-cell *matCellDef="let row" style="text-align: right">
              {{ row.aportaciones | currency : "L" }}
            </td>
          </ng-container>

          <!-- Cotizaciones Column -->
          <ng-container matColumnDef="cotizaciones">
            <th mat-header-cell *matHeaderCellDef>Cotizaciones</th>
            <td mat-cell *matCellDef="let row" style="text-align: right">
              {{ row.cotizaciones | currency : "L" }}
            </td>
          </ng-container>

          <!-- Prestamos Column -->
          <ng-container matColumnDef="prestamos">
            <th mat-header-cell *matHeaderCellDef>Préstamos</th>
            <td mat-cell *matCellDef="let row" style="text-align: right">
              {{ row.prestamos | currency : "L" }}
            </td>
          </ng-container>

          <!-- Deducciones Column -->
          <ng-container matColumnDef="deducciones">
            <th mat-header-cell *matHeaderCellDef>Deducciones</th>
            <td mat-cell *matCellDef="let row" style="text-align: right">
              {{ row.deducciones | currency : "L" }}
            </td>
          </ng-container>

          <!-- Sueldo Neto Column -->
          <ng-container matColumnDef="sueldoNeto">
            <th mat-header-cell *matHeaderCellDef>Sueldo Neto</th>
            <td mat-cell *matCellDef="let row" style="text-align: right">
              {{ row.sueldoNeto | currency : "L" }}
            </td>
          </ng-container>

          <ng-container matColumnDef="editar">
            <th mat-header-cell *matHeaderCellDef>Editar</th>
            <td mat-cell *matCellDef="let row">
              <button mat-icon-button (click)="editarElemento(row)">
                <mat-icon>edit</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- No Data Row -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="8">
              No se encuentran datos con el valor: "{{ input.value }}"
            </td>
          </tr>

          <!-- Columnas a mostrar -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns3"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns3"></tr>
        </table>

        <mat-paginator
          [pageSizeOptions]="[5, 10, 25, 100]"
          aria-label="Select page of users"
        ></mat-paginator>
      </div>
    </div>

    <div *ngIf="!showTable">
      <mat-form-field appearance="fill">
        <mat-label>Elige una fecha</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          [formControl]="fecha"
          (dateChange)="actualizarValores()"
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <div *ngIf="recargoPlanilla && totalPagarConRecargo">
        <p style="text-align: right">
          Recargo de Planilla: {{ recargoPlanilla | currency : "L" }}
        </p>
        <p style="text-align: right">
          Total a Pagar con Recargo: {{ totalPagarConRecargo | currency : "L" }}
        </p>
      </div>
    </div>
  </mat-step>
</mat-stepper>
