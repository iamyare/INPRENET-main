<!-- BUSCADOR -->
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6">
      <div class="card-header card-header-danger title" style="color: #628780">
        <h4 class="card-title">{{ titulo }}</h4>
        <p class="card-category">{{ subtitulo }}</p>
      </div>
    </div>
    <div class="col-md-6" style="text-align: right; padding: 1rem 0">
      <div class="search-container">
        <mat-form-field appearance="outline" style="background-color: white">
          <mat-label>Buscar</mat-label>
          <input matInput type="search" [formControl]="formsearch" />
          <button mat-icon-button matSuffix aria-label="Buscar">
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
  </div>
</div>

<!-- DATOS -->
<div style="overflow-x: auto">
  <table class="custom-table">
    <thead>
      <tr class="text-center">
        <th class="custom-header" *ngIf="verOpcEditar"></th>
        <th *ngFor="let col of columns" class="custom-header">
          {{ col.header }}
        </th>
        <th *ngIf="verBotEditar" class="custom-header">Acciones</th>
        <th *ngIf="mostrarBotonUno" class="custom-header">
          {{ nombreEncabezadoUno }}
        </th>
        <th *ngIf="mostrarBotonDos" class="custom-header">
          {{ nombreEncabezadoDos }}
        </th>
        <th *ngIf="mostrarBotonTres" class="custom-header">
          {{ nombreEncabezadoTres }}
        </th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="
          let row of searchResults && searchResults.slice(desde, hasta);
          let i = index
        "
        class="custom-row"
      >
        <td *ngIf="verOpcEditar">
          <!-- [(ngModel)]="row.isSelected" -->
          <input type="checkbox" (change)="onSelectionChange(row)" />
        </td>
        <td
          *ngFor="let col of columns"
          style="text-align: end; padding: 1rem 1rem 1rem 1rem"
        >
          <ng-container *ngIf="!row.isEditing && !col.moneda">
            {{ getCellValue(row, col) }}
          </ng-container>

          <ng-container *ngIf="!row.isEditing && col.moneda">
            {{ getCellValue(row, col) | currency : "L" : "symbol" : "1.2-2" }}
          </ng-container>

          <ng-container *ngIf="row.isEditing">
            <ng-container *ngIf="col.isEditable">
              <mat-form-field
                class="example-full-width; inputs"
                style="background-color: white"
                appearance="outline"
              >
                <input matInput [formControl]="row[col.col + '_control']" />
              </mat-form-field>
              <div
                *ngIf="
                  row[col.col + '_control'].invalid &&
                  row[col.col + '_control'].touched
                "
              >
                <span *ngFor="let error of getControlErrors(row, col)">
                  {{ error }}
                </span>
              </div>
            </ng-container>
            <ng-container *ngIf="!col.isEditable">
              {{ getCellValue(row, col) }}
            </ng-container>
          </ng-container>
        </td>
        <td *ngIf="verBotEditar">
          <button
            mat-raised-button
            *ngIf="!row.isEditing"
            (click)="startEditing(row)"
            style="
              background-color: #628780;
              color: #ffffff;
              border-radius: 5px;
              padding: 10px 20px;
            "
          >
            Editar
          </button>
          <button
            mat-raised-button
            *ngIf="row.isEditing"
            (click)="saveChanges(row)"
            style="
              background-color: #628780;
              color: #ffffff;
              border-radius: 5px;
              padding: 10px 20px;
            "
          >
            Guardar
          </button>
          <button
            mat-raised-button
            *ngIf="row.isEditing"
            (click)="stopEditing(row)"
            style="
              background-color: #628780;
              color: #ffffff;
              border-radius: 5px;
              padding: 10px 20px;
            "
          >
            Cancelar
          </button>
        </td>
        <td *ngIf="mostrarBotonUno">
          <button
            *ngIf="mostrarBotonUno"
            mat-raised-button
            (click)="ejecutarAccionUno(row)"
          >
            {{ etiquetaBotonUno }}
          </button>
        </td>
        <td *ngIf="mostrarBotonDos">
          <button
            *ngIf="mostrarBotonDos"
            mat-raised-button
            (click)="ejecutarAccionDos(row)"
          >
            {{ etiquetaBotonDos }}
          </button>
        </td>
        <td *ngIf="mostrarBotonTres">
          <button
            *ngIf="mostrarBotonTres"
            mat-raised-button
            (click)="ejecutarAccionTres(row)"
          >
            {{ etiquetaBotonTres }}
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<mat-paginator
  [length]="filas?.length"
  [pageSize]="itemsPerPage"
  [pageSizeOptions]="[itemsPerPage]"
  (page)="onPageChange($event)"
></mat-paginator>
